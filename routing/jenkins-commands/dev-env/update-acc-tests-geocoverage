. map-integration-testing/ci/routing/common_functions.sh
source_docker_cfg map-integration-testing/ci/routing/docker_acc.cfg
MITF_DOCKER_IMAGE=$MITF_IMAGE
MAP_FORMAT=F8

aws s3 cp s3://mitf-artifacts/artifacts/routing-hls-orig.tar.gz routing-hls.tar.gz
aws s3 cp s3://mitf-artifacts/artifacts/test_libs.tgz test_libs.tgz

tar xf routing-hls.tar.gz
rm routing-hls.tar.gz
mkdir test_libs
tar xf test_libs.tgz -C test_libs

docker pull $MITF_DOCKER_IMAGE
trap "{ [ -z $BUILD_TAG ] || docker ps -aq --filter name=$BUILD_TAG | xargs --no-run-if-empty docker rm -f --volumes || true; } &> /dev/null" EXIT
docker run \
    --env=MITF_PATH=/workspace \
    --env=MAP_FORMAT=$MAP_FORMAT \
    --env=VIRTUAL_TIMEOUT=2m \
    --interactive \
    --name=$BUILD_TAG \
    --net=host \
    --rm \
    --user=bldadmin \
    --volume=$WORKSPACE:/workspace \
    --workdir=/workspace \
    $MITF_DOCKER_IMAGE \
    map-integration-testing/ci/routing/acceptance/update_acc_tests.sh

mv share/here/routing/spec share/here/routing/spec_orig
mkdir -p share/here/routing/spec/
tar xf robot_specs.tgz -C share/here/routing/spec/
tar -czvf routing-hls.tar.gz *
# aws s3 cp routing-hls.tar.gz s3://mitf-artifacts/artifacts/routing-hls.tar.gz
