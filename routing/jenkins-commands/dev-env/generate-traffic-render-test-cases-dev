# Temporary patch to see a list of generated xml files
echo "find \${MITF_PATH} -type f -name *.xml" >> map-integration-testing/ci/routing/mitf_runner.sh

. map-integration-testing/ci/routing/common_functions.sh
source_docker_cfg map-integration-testing/ci/routing/docker.cfg
docker pull $DOCKER_IMAGE
set_env_var_if_not_set DB_PATH /home/bldadmin/data
trap "{ [ -z $BUILD_TAG ] || docker ps -aq --filter name=$BUILD_TAG | xargs --no-run-if-empty docker rm -f --volumes || true; } &> /dev/null" EXIT

docker run \
    --env LDM_REGION_DVN=${LDM_REGION_DVN} \
    --env LDM_SAVE_AS_DVN=${LDM_SAVE_AS_DVN} \
    --env MITF_PATH=/workspace \
    --env DB_PATH=$DB_PATH \
    --env USE_CACHE=$USE_CACHE \
    --interactive \
    --name=$BUILD_TAG \
    --rm \
    --user=bldadmin \
    --volume=$WORKSPACE:/workspace \
    --volume=$DB_PATH:$DB_PATH \
    --workdir=/workspace \
    $DOCKER_IMAGE \
    map-integration-testing/ci/traffic/render_tests.sh $DESIRED_TC_QTY "$GENERATORS"
