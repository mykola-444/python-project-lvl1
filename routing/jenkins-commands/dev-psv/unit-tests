. map-integration-testing/ci/routing/common_functions.sh
source_docker_cfg map-integration-testing/ci/routing/docker.cfg
docker pull $DOCKER_IMAGE

trap "{ [ -z $BUILD_TAG ] || docker ps -aq --filter name=$BUILD_TAG | xargs --no-run-if-empty docker rm -f --volumes || true; } &> /dev/null" EXIT

docker run \
    --env=PYTHONPATH=/workspace/map-integration-testing \
    --interactive \
    --rm \
    --name=$BUILD_TAG \
    --user=bldadmin \
    --volume=$WORKSPACE:/workspace \
    --workdir=/workspace \
    $DOCKER_IMAGE bash -esux << "EOS"
    sudo apt-get update -y
    sudo apt-get install -y libmagickwand-dev
    cd map-integration-testing
    sudo pip3 install tenacity selenium wand
    python3 -m unittest discover --pattern=*.py -v
EOS
